
-----------------------------------------------------------------------------------------------------------------
18. seguridad en ruby on rails 
18.1  Historia del concepto / ¿ Por qué lo inventaron ?
18.2  Ventajas: 
18.3  Desventajas:
18.4 Ejemplo en producción 

# Métodos de seguridad en Ruby on Rails

## Concepto

Los métodos de seguridad en Ruby on Rails son un conjunto de prácticas, configuraciones y herramientas que protegen aplicaciones web contra vulnerabilidades como inyección SQL, Cross-Site Scripting (XSS), Cross-Site Request Forgery (CSRF), ataques de fuerza bruta, exposición de datos sensibles y acceso no autorizado. Rails integra estas medidas de forma nativa, promoviendo la seguridad desde el diseño de la aplicación.

## Historia del concepto / Por qué lo inventaron

Durante los primeros años del desarrollo web, las aplicaciones eran altamente vulnerables a ataques que comprometían datos de usuarios y la integridad del sistema. Rails fue diseñado para simplificar la construcción de aplicaciones seguras, ofreciendo protecciones integradas y facilitando a los desarrolladores la adopción de buenas prácticas de seguridad sin depender completamente de configuraciones externas.

## Ejemplos de métodos de seguridad específicos

1. **Protección CSRF (Cross-Site Request Forgery)**

   * Rails incluye un token único en formularios y solicitudes POST/PUT/DELETE para prevenir que un atacante ejecute acciones en nombre de un usuario.

```ruby
class ApplicationController < ActionController::Base
  protect_from_forgery with: :exception
end
```

2. **Strong Parameters**

   * Restringe los parámetros que un usuario puede enviar para prevenir inyección de atributos.

```ruby
def user_params
  params.require(:user).permit(:name, :email, :password, :password_confirmation)
end
```

3. **Cifrado de contraseñas y autenticación segura**

   * Rails utiliza bcrypt y `has_secure_password` para almacenar contraseñas de manera segura.

```ruby
class User < ApplicationRecord
  has_secure_password
end
```

4. **Escape de HTML y sanitización (prevención XSS)**

   * Sanitiza entradas del usuario antes de mostrarlas para evitar la ejecución de scripts maliciosos.

```erb
<%= sanitize @user.bio %>
```

5. **Protección contra inyección SQL**

   * ActiveRecord utiliza consultas parametrizadas para evitar que usuarios inyecten código SQL malicioso.

```ruby
User.where(email: params[:email])
```

6. **Cabeceras de seguridad HTTP**

   * Configuración de Content Security Policy (CSP), Strict-Transport-Security (HSTS) y X-Frame-Options para proteger contra XSS y clickjacking.

```ruby
Rails.application.config.content_security_policy do |policy|
  policy.default_src :self
  policy.script_src :self, :https
  policy.style_src :self, :https
end
```

7. **Limitación de intentos de login (prevención de fuerza bruta)**

   * Uso de `rack-attack` para bloquear IPs tras múltiples intentos fallidos de autenticación.

```ruby
class Rack::Attack
  throttle('logins/ip', limit: 5, period: 20.seconds) do |req|
    req.ip if req.path == '/login' && req.post?
  end
end
```

8. **Cifrado de datos sensibles**

   * Uso de gemas como `Lockbox` o `Active Record Encryption` para cifrar información confidencial en la base de datos.

```ruby
class User < ApplicationRecord
  encrypts :ssn
end
```

9. **Auditoría y monitoreo de seguridad**

   * Uso de herramientas como `Brakeman` para análisis estático de código y revisión periódica de logs para detectar actividad sospechosa.

## Ventajas

* Protección contra las vulnerabilidades web más comunes.
* Rails integra estas medidas de forma nativa, facilitando la implementación y reduciendo errores humanos.
* Facilita el cumplimiento de regulaciones de datos como GDPR o HIPAA.
* Mejora la confianza de los usuarios al proteger su información.

## Desventajas

* Requiere conocimiento profundo de cada método para configurarlos correctamente.
* Algunas protecciones pueden requerir ajustes según la complejidad de la aplicación.
* Puede afectar ligeramente el rendimiento si se implementan de manera ineficiente.

## Ejemplo en producción

* **Autenticación y autorización:** Uso de Devise y Pundit para gestionar usuarios, roles y permisos.
* **Protección contra fuerza bruta:** `rack-attack` configurado para limitar intentos de login y prevenir ataques automatizados.
* **Cifrado de datos sensibles:** Uso de Lockbox o Active Record Encryption para proteger datos personales y financieros.
* **Content Security Policy y cabeceras de seguridad:** Configuradas para prevenir XSS, clickjacking y carga de contenido malicioso.
* **Auditoría y análisis de código:** Integración de Brakeman en CI/CD para detectar vulnerabilidades antes de desplegar.
